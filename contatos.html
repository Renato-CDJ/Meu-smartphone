<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contatos</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="smartphone">
  <div class="phone">
    <header class="home-header">
      <h2>Contatos</h2>
    </header>
    <main class="home-main">
      <form id="form-contato" style="display: flex; padding: 10px; gap: 8px;">
        <input type="text" id="contatoNome" placeholder="Nome do usu√°rio..." required style="flex: 1; padding: 8px; border-radius: 10px; border: 1px solid #ccc;">
        <button type="submit" style="padding: 8px 16px; border-radius: 10px; background: #ff4d6d; color: white; border: none;">+</button>
      </form>
      <ul id="lista-contatos" style="list-style: none; padding: 0 10px;"></ul>
    </main>
    <footer class="home-footer">
      <button onclick="window.location.href='home.html'">‚¨Ö Voltar</button>
    </footer>
  </div>

  <script type="module">
    import { db, doc, getDoc, updateDoc, arrayUnion } from './firebase.js';

    const user = localStorage.getItem("usuario");
    const form = document.getElementById("form-contato");
    const lista = document.getElementById("lista-contatos");

    async function carregarContatos() {
      if (!user) return;
      const ref = doc(db, "usuarios", user);
      const snap = await getDoc(ref);
      const contatos = snap.exists() ? snap.data().contatos || [] : [];

      lista.innerHTML = "";
      contatos.forEach(nome => {
        const li = document.createElement("li");
        const link = document.createElement("a");
        link.href = `chat.html?contato=${nome}`;
        link.textContent = `üí¨ ${nome}`;
        li.appendChild(link);
        lista.appendChild(li);
      });
    }

    form.addEventListener("submit", async e => {
      e.preventDefault();
      const nomeContato = document.getElementById("contatoNome").value.trim();
      if (!nomeContato || nomeContato === user) return;

      const contatoSnap = await getDoc(doc(db, "usuarios", nomeContato));
      if (!contatoSnap.exists()) {
        alert("Usu√°rio n√£o encontrado.");
        return;
      }

      await updateDoc(doc(db, "usuarios", user), {
        contatos: arrayUnion(nomeContato)
      });

      document.getElementById("contatoNome").value = "";
      carregarContatos();
    });

    carregarContatos();
  </script>
</body>
</html>
